<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>KTT í†µí•© ë¦¬í…ì…˜ ëŒ€ì‹œë³´ë“œ (Final Fix)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbmyeJMsApj38SRzWvaQGrZmpqUQTooMw" defer></script>
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

    <style>
        :root { --primary:#2563eb; --bg:#f8fafc; --card:#fff; --text:#334155; }
        body { margin:0; font-family:'Pretendard', sans-serif; background:var(--bg); color:var(--text); height:100vh; overflow:hidden; display:flex; }
        * { box-sizing:border-box; }
        
        /* Spinner */
        #loadingOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .spinner { width:40px; height:40px; border:4px solid #eff6ff; border-top:4px solid var(--primary); border-radius:50%; animation:spin 0.8s infinite linear; }
        @keyframes spin { 100%{transform:rotate(360deg);} }

        /* Layout */
        .sidebar { width:280px; background:var(--card); border-right:1px solid #e2e8f0; display:flex; flex-direction:column; z-index:10; }
        .sidebar-header { padding:24px; font-size:18px; font-weight:700; border-bottom:1px solid #e2e8f0; }
        .sidebar-content { flex:1; overflow-y:auto; padding:24px; }
        .content { flex:1; padding:32px; overflow-y:auto; }

        /* Controls */
        .file-box { background:#f1f5f9; padding:15px; border-radius:8px; margin-bottom:20px; text-align:center; font-size:12px; }
        .view-tabs { display:flex; background:#f1f5f9; padding:4px; border-radius:8px; margin-bottom:20px; }
        .view-tabs button { flex:1; padding:8px; border:none; background:none; font-weight:600; cursor:pointer; color:#64748b; border-radius:6px; }
        .view-tabs button.active { background:#fff; color:var(--primary); box-shadow:0 1px 2px rgba(0,0,0,0.1); }
        
        select { width:100%; padding:8px; margin-bottom:12px; border:1px solid #cbd5e1; border-radius:6px; }
        .filter-btns { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:12px; }
        .btn-filter { padding:5px 10px; font-size:12px; border:1px solid #e2e8f0; background:#fff; border-radius:15px; cursor:pointer; }
        .btn-filter.active { background:var(--primary); color:#fff; border-color:var(--primary); }

        /* Dashboard */
        .dashboard-view { display:none; }
        .dashboard-view.active { display:block; animation:fade 0.3s; }
        @keyframes fade { from{opacity:0;transform:translateY(5px);} to{opacity:1;transform:translateY(0);} }

        .kpi-row { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:24px; }
        .kpi-box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,0.05); border-left:4px solid var(--primary); }
        .kpi-title { font-size:12px; color:#64748b; font-weight:600; text-transform:uppercase; }
        .kpi-val { font-size:24px; font-weight:800; margin-top:5px; }

        .map-box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,0.05); margin-bottom:24px; }
        #vocMap { width:100%; height:450px; border-radius:8px; background:#eee; }

        .chart-row { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:24px; }
        .chart-box { background:#fff; padding:20px; border-radius:12px; height:350px; box-shadow:0 2px 4px rgba(0,0,0,0.05); }

        /* Table */
        .table-box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
        .tbl-wrap { overflow-x:auto; max-height:500px; margin-top:15px; }
        table { width:100%; border-collapse:collapse; font-size:13px; white-space:nowrap; }
        th { background:#f8fafc; padding:12px; text-align:left; position:sticky; top:0; z-index:5; border-bottom:1px solid #e2e8f0; }
        td { padding:10px 12px; border-bottom:1px solid #f1f5f9; cursor:pointer; }
        tr:hover td { background:#f8fafc; }
        tr.selected td { background:#eff6ff !important; font-weight:600; }
        
        .pg-controls { display:flex; justify-content:space-between; margin-top:15px; align-items:center; font-size:13px; color:#64748b; }
        .pg-btn { padding:5px 12px; border:1px solid #e2e8f0; background:#fff; border-radius:4px; cursor:pointer; }
        .pg-btn:disabled { opacity:0.5; cursor:not-allowed; }

        .badge { padding:3px 8px; border-radius:10px; font-size:11px; font-weight:600; }
        .bd-done { background:#dbeafe; color:#1e40af; }
        .bd-wait { background:#fee2e2; color:#991b1b; }
        .bd-ing { background:#fef3c7; color:#92400e; }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div class="spinner"></div>
    <div style="margin-top:15px; font-weight:600; color:#475569">ë°ì´í„° ë¡œë“œ ì¤‘...</div>
</div>

<div class="sidebar">
    <div class="sidebar-header">KTT ë¦¬í…ì…˜ ëŒ€ì‹œë³´ë“œ</div>
    <div class="sidebar-content">
        <div class="file-box">
            <input type="file" id="csvFile" accept=".csv" />
            <div style="margin-top:5px; color:#64748b;">(VOC ë˜ëŠ” íŒŒì´í”„ë¼ì¸ íŒŒì¼)</div>
        </div>

        <div class="view-tabs">
            <button class="active" onclick="setView('voc')">VOC í˜„í™©</button>
            <button onclick="setView('pipeline')">íŒŒì´í”„ë¼ì¸</button>
        </div>

        <div id="filterVoc">
            <label style="font-size:12px; font-weight:600;">VOC ìœ í˜•</label>
            <select id="selVocType"><option value="ALL">ì „ì²´</option></select>
            
            <label style="font-size:12px; font-weight:600;">ì²˜ë¦¬ ìƒíƒœ</label>
            <div class="filter-btns" id="btnVocStatus">
                <button class="btn-filter active" data-val="ALL">ì „ì²´</button>
                <button class="btn-filter" data-val="ì²˜ë¦¬ì™„ë£Œ">ì™„ë£Œ</button>
                <button class="btn-filter" data-val="ì ‘ìˆ˜">ì ‘ìˆ˜</button>
                <button class="btn-filter" data-val="ë¯¸ì ‘ìˆ˜">ë¯¸ì ‘ìˆ˜</button>
            </div>

            <label style="font-size:12px; font-weight:600;">ê´€ë¦¬ì§€ì‚¬</label>
            <select id="selVocBranch"><option value="ALL">ì „ì²´</option></select>

            <label style="font-size:12px; font-weight:600;">ë‹´ë‹¹ì</label>
            <select id="selVocAgent"><option value="ALL">ì „ì²´</option></select>
        </div>

        <div id="filterPipe" style="display:none;">
            <label style="font-size:12px; font-weight:600;">ìœ„í—˜ë„</label>
            <select id="selPipeRisk">
                <option value="ALL">ì „ì²´</option>
                <option value="75">ê³ ìœ„í—˜ (75%â†‘)</option>
                <option value="50">ì¤‘ìœ„í—˜ (50~75%)</option>
            </select>
            <label style="font-size:12px; font-weight:600;">ê´€ë¦¬ì§€ì‚¬</label>
            <select id="selPipeBranch"><option value="ALL">ì „ì²´</option></select>
        </div>
    </div>
</div>

<div class="content">
    
    <div id="viewVoc" class="dashboard-view active">
        <h2 style="margin:0 0 20px 0;">ê´€ë¦¬ê³ ê°(VOC) í™œë™ í˜„í™©</h2>
        
        <div class="kpi-row">
            <div class="kpi-box">
                <div class="kpi-title">ì´ ê³„ì•½ (Unique)</div>
                <div class="kpi-val" id="kpiVocTotal">0</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-title">ì²˜ë¦¬ ì™„ë£Œ</div>
                <div class="kpi-val" style="color:#10b981;" id="kpiVocDone">0</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-title">ì²˜ë¦¬ìœ¨</div>
                <div class="kpi-val" id="kpiVocRate">0%</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-title">ë¯¸ì ‘ìˆ˜</div>
                <div class="kpi-val" style="color:#ef4444;" id="kpiVocWait">0</div>
            </div>
        </div>

        <div class="map-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h3 style="margin:0;">ğŸ“ ê³ ê° ìœ„ì¹˜ í˜„í™©</h3>
                <span style="font-size:12px; color:#64748b;">*ì¢Œí‘œê°€ ìˆëŠ” ë°ì´í„°ë§Œ ì§€ë„ì— í‘œì‹œë©ë‹ˆë‹¤. (í…Œì´ë¸”ì€ ì „ì²´ í‘œì‹œ)</span>
            </div>
            <div id="vocMap"></div>
        </div>

        <div class="chart-row">
            <div class="chart-box">
                <h4 style="margin:0 0 10px 0;">ì§€ì‚¬ë³„ í˜„í™©</h4>
                <canvas id="chartVocBranch"></canvas>
            </div>
            <div class="chart-box">
                <h4 style="margin:0 0 10px 0;">ë‹´ë‹¹ì í™œë™ (ìƒìœ„ 10)</h4>
                <canvas id="chartVocAgent"></canvas>
            </div>
        </div>

        <div class="table-box">
            <h3 style="margin:0;">ìƒì„¸ ë°ì´í„° (ì „ì²´)</h3>
            <div class="tbl-wrap">
                <table id="tblVoc">
                    <thead>
                        <tr>
                            <th>ì§€ì‚¬</th><th>ë‹´ë‹¹ì</th><th>ê³„ì•½ë²ˆí˜¸</th><th>ìƒí˜¸</th><th>ìƒíƒœ</th><th>ì„œë¹„ìŠ¤</th><th>ì¢Œí‘œìœ ë¬´</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="pg-controls">
                <span id="pgInfoVoc">0 / 0</span>
                <div>
                    <button class="pg-btn" onclick="movePage(-1)">ì´ì „</button>
                    <button class="pg-btn" onclick="movePage(1)">ë‹¤ìŒ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="viewPipe" class="dashboard-view">
        <h2 style="margin:0 0 20px 0;">í•´ì§€ íŒŒì´í”„ë¼ì¸ ë¶„ì„</h2>
        <div class="kpi-row">
            <div class="kpi-box"><div class="kpi-title">ëŒ€ìƒ ê±´ìˆ˜</div><div class="kpi-val" id="kpiPipeTotal">0</div></div>
            <div class="kpi-box"><div class="kpi-title">ê³ ìœ„í—˜êµ°</div><div class="kpi-val" style="color:#ef4444;" id="kpiPipeHigh">0</div></div>
            <div class="kpi-box"><div class="kpi-title">ë°©ì–´ ì„±ê³µ</div><div class="kpi-val" style="color:#10b981;" id="kpiPipeSuc">0</div></div>
            <div class="kpi-box"><div class="kpi-title">ë°©ì–´ìœ¨</div><div class="kpi-val" id="kpiPipeRate">0%</div></div>
        </div>
        <div class="table-box">
            <div class="tbl-wrap">
                <table id="tblPipe">
                    <thead><tr><th>ì§€ì‚¬</th><th>ê³„ì•½ë²ˆí˜¸</th><th>ìƒí˜¸</th><th>ìœ„í—˜ë„</th><th>ë‹¨ê³„</th><th>í•´ì§€ì˜ˆì •ì¼</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script>
/* ================= DATA & STATE ================= */
const DATA_URLS = {
    voc: "https://raw.githubusercontent.com/bough38-web/retention-dashboard/main/voc.csv",
    pipe: "https://raw.githubusercontent.com/bough38-web/retention-dashboard/main/pipeline.csv"
};

let appState = {
    view: 'voc', // 'voc' or 'pipeline'
    data: { voc:[], pipe:[] },
    filter: { voc:[], pipe:[] }, // filtered data
    page: 1,
    limit: 15
};

let map, clusterer, markers = [];
let charts = {};

/* ================= INIT ================= */
window.onload = async () => {
    try {
        const [v, p] = await Promise.all([ fetchCsv(DATA_URLS.voc), fetchCsv(DATA_URLS.pipe) ]);
        appState.data.voc = parseVocData(v.data);
        appState.data.pipe = p.data;
        
        initMap();
        initFilters();
        applyFilter();
    } catch(e) { console.error(e); }
    document.getElementById("loadingOverlay").style.display = "none";
};

async function fetchCsv(url) {
    const res = await fetch(url);
    const txt = await res.text();
    return Papa.parse(txt, { header:true, skipEmptyLines:true });
}

/* ================= PARSING LOGIC (CRITICAL FIX) ================= */
function parseVocData(rows) {
    // 1. Find the complex key matching "ìœ„ì¹˜ì¢Œí‘œ"
    if(!rows.length) return [];
    const keys = Object.keys(rows[0]);
    const coordKey = keys.find(k => k.includes("ìœ„ì¹˜ì¢Œí‘œ")); // BOM safe check

    return rows.map(r => {
        // ì¢Œí‘œ íŒŒì‹±
        let lat=null, lng=null;
        
        // ìš°ì„ ìˆœìœ„ 1: "ìœ„ì¹˜ì¢Œí‘œ(ìœ„ë„,ê²½ë„)" ì»¬ëŸ¼ íŒŒì‹± (ì˜ˆ: "37.123, 127.123")
        if (coordKey && r[coordKey]) {
            const parts = r[coordKey].split(',');
            if(parts.length === 2) {
                lat = parseFloat(parts[0].trim());
                lng = parseFloat(parts[1].trim());
            }
        }
        // ìš°ì„ ìˆœìœ„ 2: ë³„ë„ "ìœ„ë„", "ê²½ë„" ì»¬ëŸ¼
        if ((isNaN(lat) || !lat) && r["ìœ„ë„"] && r["ê²½ë„"]) {
            lat = parseFloat(r["ìœ„ë„"]);
            lng = parseFloat(r["ê²½ë„"]);
        }

        return {
            ...r,
            _lat: (!isNaN(lat) && lat) ? lat : null,
            _lng: (!isNaN(lng) && lng) ? lng : null,
            _branch: (r["ê´€ë¦¬ì§€ì‚¬"]||"").replace("ì§€ì‚¬","").trim(),
            _status: (r["ìƒíƒœ"]||"").trim(),
            _type: (r["VOCìœ í˜•ëŒ€"]||"").trim(),
            _agent: (r["ë‹´ë‹¹ì"]||"").trim()
        };
    });
}

/* ================= FILTERS ================= */
function initFilters() {
    // VOC Options
    const branches = [...new Set(appState.data.voc.map(r=>r._branch))].sort();
    const agents = [...new Set(appState.data.voc.map(r=>r._agent))].sort();
    const types = [...new Set(appState.data.voc.map(r=>r._type))].sort();

    fillSelect("selVocBranch", branches);
    fillSelect("selVocAgent", agents);
    fillSelect("selVocType", types);

    // Event Listeners
    document.querySelectorAll("#filterVoc select").forEach(s => s.onchange = () => { appState.page=1; applyFilter(); });
    
    // Status Buttons
    document.querySelectorAll("#btnVocStatus button").forEach(btn => {
        btn.onclick = (e) => {
            document.querySelectorAll("#btnVocStatus button").forEach(b=>b.classList.remove("active"));
            e.target.classList.add("active");
            appState.page=1; applyFilter();
        };
    });
}

function fillSelect(id, list) {
    const sel = document.getElementById(id);
    sel.innerHTML = '<option value="ALL">ì „ì²´</option>';
    list.forEach(v => { if(v) sel.innerHTML += `<option value="${v}">${v}</option>`; });
}

function applyFilter() {
    if(appState.view === 'voc') {
        const branch = document.getElementById("selVocBranch").value;
        const agent = document.getElementById("selVocAgent").value;
        const type = document.getElementById("selVocType").value;
        const status = document.querySelector("#btnVocStatus .active").dataset.val;

        appState.filter.voc = appState.data.voc.filter(r => {
            if(branch !== 'ALL' && r._branch !== branch) return false;
            if(agent !== 'ALL' && r._agent !== agent) return false;
            if(type !== 'ALL' && r._type !== type) return false;
            if(status !== 'ALL' && r._status !== status) return false;
            return true;
        });
        
        renderVocView();
    } else {
        // Pipeline filtering (Simplified for brevity)
        appState.filter.pipe = appState.data.pipe;
        renderPipeView();
    }
}

/* ================= RENDER LOGIC ================= */
function renderVocView() {
    const data = appState.filter.voc;

    // 1. KPIs (Unique Contract Count)
    const uniqueContracts = new Set(data.map(r=>r["ê³„ì•½ë²ˆí˜¸"])).size;
    const done = data.filter(r=>r._status==='ì²˜ë¦¬ì™„ë£Œ').length;
    const wait = data.filter(r=>r._status==='ë¯¸ì ‘ìˆ˜').length;
    
    document.getElementById("kpiVocTotal").innerText = uniqueContracts.toLocaleString();
    document.getElementById("kpiVocDone").innerText = done.toLocaleString();
    document.getElementById("kpiVocWait").innerText = wait.toLocaleString();
    document.getElementById("kpiVocRate").innerText = uniqueContracts ? ((done/data.length)*100).toFixed(1)+"%" : "0%";

    // 2. Map (Only rows with valid coords)
    updateMap(data);

    // 3. Table (All rows, paged)
    renderTable(data, "tblVoc");

    // 4. Charts
    updateCharts(data);
}

/* ================= MAP ================= */
function initMap() {
    map = new google.maps.Map(document.getElementById("vocMap"), {
        center: { lat: 37.5665, lng: 126.9780 },
        zoom: 8,
        fullscreenControl: false, mapTypeControl: false
    });
}

function updateMap(data) {
    if(!map) return;
    if(clusterer) clusterer.clearMarkers();
    markers = [];

    // Filter valid coords ONLY for map
    const mapData = data.filter(r => r._lat !== null && r._lng !== null);

    mapData.forEach(r => {
        const marker = new google.maps.Marker({
            position: { lat: r._lat, lng: r._lng },
            title: r["ìƒí˜¸"],
            // Simple Icon logic
            icon: `https://maps.google.com/mapfiles/ms/icons/$${r._status==='ì²˜ë¦¬ì™„ë£Œ'?'blue':'red'}-dot.png`
        });
        
        const content = `<div style="padding:5px;"><b>${r["ìƒí˜¸"]}</b><br>${r._status}</div>`;
        const infowindow = new google.maps.InfoWindow({ content });
        marker.addListener("click", () => infowindow.open(map, marker));
        
        markers.push(marker);
    });

    clusterer = new markerClusterer.MarkerClusterer({ map, markers });
}

/* ================= TABLE ================= */
function renderTable(data, tableId) {
    const tbody = document.querySelector(`#${tableId} tbody`);
    tbody.innerHTML = "";
    
    const start = (appState.page - 1) * appState.limit;
    const end = start + appState.limit;
    const pageData = data.slice(start, end);

    document.getElementById("pgInfoVoc").innerText = `${data.length}ê±´ ì¤‘ ${Math.min(end, data.length)} í‘œê¸°`;

    pageData.forEach(r => {
        const tr = document.createElement("tr");
        if(tableId === 'tblVoc') {
            const hasLoc = (r._lat) ? "Y" : "<span style='color:#ccc'>N</span>";
            let badgeClass = r._status === 'ì²˜ë¦¬ì™„ë£Œ' ? 'bd-done' : (r._status === 'ì ‘ìˆ˜' ? 'bd-ing' : 'bd-wait');
            
            tr.innerHTML = `
                <td>${r._branch}</td>
                <td>${r._agent}</td>
                <td>${r["ê³„ì•½ë²ˆí˜¸"]}</td>
                <td style="font-weight:bold; text-align:left;">${r["ìƒí˜¸"]||"-"}</td>
                <td><span class="badge ${badgeClass}">${r._status}</span></td>
                <td>${r["VOCìœ í˜•ì†Œ"]||"-"}</td>
                <td style="text-align:center;">${hasLoc}</td>
            `;
            // Click to pan map
            if(r._lat) {
                tr.onclick = () => {
                    map.panTo({lat:r._lat, lng:r._lng});
                    map.setZoom(14);
                    // Highlight logic could go here
                };
            }
        }
        tbody.appendChild(tr);
    });
}

function movePage(dir) {
    const total = appState.filter.voc.length;
    const maxPage = Math.ceil(total / appState.limit);
    let newPage = appState.page + dir;
    if(newPage > 0 && newPage <= maxPage) {
        appState.page = newPage;
        renderTable(appState.filter.voc, "tblVoc");
    }
}

/* ================= CHARTS ================= */
function updateCharts(data) {
    // 1. Branch Chart
    const brCounts = {};
    data.forEach(r => { brCounts[r._branch] = (brCounts[r._branch]||0)+1; });
    
    if(charts.branch) charts.branch.destroy();
    charts.branch = new Chart(document.getElementById("chartVocBranch"), {
        type: 'bar',
        data: {
            labels: Object.keys(brCounts),
            datasets: [{
                label: 'ê±´ìˆ˜',
                data: Object.values(brCounts),
                backgroundColor: '#3b82f6',
                borderRadius: 4
            }]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}} }
    });

    // 2. Agent Chart (Top 10)
    const agCounts = {};
    data.forEach(r => { if(r._agent) agCounts[r._agent] = (agCounts[r._agent]||0)+1; });
    const sortedAg = Object.entries(agCounts).sort((a,b)=>b[1]-a[1]).slice(0,10);

    if(charts.agent) charts.agent.destroy();
    charts.agent = new Chart(document.getElementById("chartVocAgent"), {
        type: 'bar',
        data: {
            labels: sortedAg.map(x=>x[0]),
            datasets: [{
                label: 'ê±´ìˆ˜',
                data: sortedAg.map(x=>x[1]),
                backgroundColor: '#10b981',
                borderRadius: 4
            }]
        },
        options: { responsive:true, maintainAspectRatio:false, indexAxis:'y', plugins:{legend:{display:false}} }
    });
}

/* ================= UTILS ================= */
function setView(v) {
    appState.view = v;
    document.querySelectorAll(".view-tabs button").forEach(b => b.classList.remove("active"));
    event.target.classList.add("active");
    
    document.querySelectorAll(".dashboard-view").forEach(d => d.classList.remove("active"));
    document.getElementById(v==='voc' ? 'viewVoc' : 'viewPipe').classList.add("active");
    
    document.getElementById("filterVoc").style.display = (v==='voc') ? 'block' : 'none';
    document.getElementById("filterPipe").style.display = (v==='pipeline') ? 'block' : 'none';
    
    applyFilter();
}

// Manual Upload
document.getElementById('csvFile').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => {
        const parsed = Papa.parse(evt.target.result, {header:true, skipEmptyLines:true});
        if(parsed.meta.fields.includes("ìœ„ì¹˜ì¢Œí‘œ(ìœ„ë„,ê²½ë„)") || parsed.meta.fields.includes("ìœ„ë„")) {
            appState.data.voc = parseVocData(parsed.data);
            initFilters();
            setView('voc');
            alert("VOC ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ");
        } else {
            appState.data.pipe = parsed.data;
            setView('pipeline');
            alert("íŒŒì´í”„ë¼ì¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ");
        }
    };
    reader.readAsText(file, 'UTF-8');
});

</script>
</body>
</html>
